<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>餐廳桌位管理 </title>
    <style>
        h1 {
        font-size: 28px; /* 調整 h1 的字體大小 */
    }
    h2 {
        font-size: 24px; /* 調整 h2 的字體大小 */
    }
    h3 {
        font-size: 24px; /* 調整 h3 的字體大小 */
    }
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .table-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        .table {
            width: 120px;
            height: 120px;
            margin: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            position: relative;
            padding: 5px;
        }
        .reservation-id {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 12px;
            color: #666;
        }
        .empty { background-color: #ccc; }
        .reserved { background-color: #ffeb3b; }
        .occupied { background-color: #b5d860; }
        .finished { background-color: #d9534f; color: white; }
        .finished::after { content: "收桌中"; font-size: 16px; }

        .input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        input, button, select {
            padding: 10px;
            font-size: 16px;
        }
        .row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .name-buttons {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            justify-content: center;
        }
        .name-buttons button {
            padding: 5px 10px;
            background-color: #ddd;
            border: none;
            cursor: pointer;
        }
        .name-buttons button.active {
            background-color: #007bff;
            color: white;
        }
        .waitlist-item {
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-self: center;
            gap: 10px;
            margin-left: -30px;
            width: 100%;
            max-width: 500px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #F7F7F7;
            text-align: center; /* 讓內部文字與 inline 元素置中 */
        }
        .button-container {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .table-button {
            padding: 5px 10px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            margin: 2px;
        }
        .confirm-button {
            padding: 5px 10px;
            background-color: #17a2b8;
            color: white;
            border: none;
            cursor: pointer;
            
        }
        .cancel-button {
            padding: 5px 10px;
            background-color: #d9534f;
            color: white;
            border: none;
            cursor: pointer;
        }
        .time-info {
            font-size: 16px;
            margin-top: 5px;
        }
        .before-time {
            color: #28a745;
        }
        .after-time {
            color: #e51f1a;
        }
    </style>
</head>
<body>
    <h1>餐廳桌位管理</h1>
    <div class="table-container" id="tables"></div>

    <h2>已訂位</h2>
    <div class="input-container">
        <div class="row">
            <input type="number" id="reservedCount" placeholder="人數" min="1">
        </div>
        <div class="row">
            <input type="text" id="reservedName" placeholder="姓氏">
        </div>
        <div class="name-buttons">
            <button id="mrButtonReserved" onclick="selectTitleReserved('先生')">先生</button>
            <button id="msButtonReserved" onclick="selectTitleReserved('小姐')">小姐</button>
        </div>
        <input type="text" id="reservedPhone" placeholder="手機">
        <select id="reservedTime">
            <option value="11:00">11:00</option>
            <option value="11:30">11:30</option>
            <option value="12:00">12:00</option>
            <option value="12:30">12:30</option>
            <option value="13:00">13:00</option>
        
            <option value="17:00">17:00</option>
            <option value="17:30">17:30</option>
            <option value="18:00">18:00</option>
            <option value="18:30">18:30</option>
            <option value="19:00">19:00</option>
            <option value="19:30">19:30</option>
            <option value="20:00">20:00</option>
        </select>
        <button onclick="addToReservedList()">新增訂位</button>
    </div>
    <ul id="reservedList"></ul>

    <!-- 新增候位管理區域 -->
    <h3>已候位</h3>
    <div class="input-container">
        <div class="row">
            <input type="number" id="waitingCount" placeholder="人數" min="1">
        </div>
        <div class="row">
            <input type="text" id="waitingName" placeholder="姓氏">
        </div>
        <div class="name-buttons">
            <button id="mrButtonWaiting" onclick="selectTitleWaiting('先生')">先生</button>
            <button id="msButtonWaiting" onclick="selectTitleWaiting('小姐')">小姐</button>
        </div>
        <input type="text" id="waitingPhone" placeholder="手機">
        <button onclick="addToWaitingList()">新增候位</button>
    </div>
    <ul id="waitingList"></ul>

    <script>
        const tables = [1, 2, 4, 5, 6, 7, 8, 10];
        const tableStatus = {};
        let reservedList = [];
        let waitingList = [];
        let reservationCounter = 1;
        let waitingCounter = 1;
        let selectedTitleReserved = "先生";
        let selectedTitleWaiting = "先生";

        function renderTables() {
            const container = document.getElementById("tables");
            container.innerHTML = "";

            tables.forEach(table => {
                const status = tableStatus[table]?.status || "empty";
                const tableDiv = document.createElement("div");
                tableDiv.className = `table ${status}`;
                
                if (tableStatus[table]?.reservationId) {
                    const reservationId = document.createElement("div");
                    reservationId.className = "reservation-id";
                    reservationId.textContent = `訂${tableStatus[table].reservationId}`;
                    tableDiv.appendChild(reservationId);
                }

                const tableNumber = document.createElement("div");
                tableNumber.textContent = `A${table}`;
                tableDiv.appendChild(tableNumber);

                if (status === "occupied" && tableStatus[table].startTime) {
                    const startTime = tableStatus[table].startTime;
                    const endTime = new Date(startTime.getTime() + 90 * 60000);
                    const timeInfo = document.createElement("div");
                    timeInfo.className = "time-info";
                    timeInfo.innerHTML = 
                        `${formatTime(startTime)} 入座<br>
                        ${formatTime(endTime)} 結束`
                    ;
                    tableDiv.appendChild(timeInfo);
                }

                if (status === "reserved" && tableStatus[table]?.reservedTime) {
                    const timeInfo = document.createElement("div");
                    timeInfo.className = "time-info";
                    
                    const reservedTime = tableStatus[table].reservedTime;
                    const beforeTime = getTimeBeforeReservation(reservedTime);
                    const afterTime = getTimeAfterReservation(reservedTime);
                    
                    timeInfo.innerHTML = 
                        `<div class="before-time">${beforeTime} 前可接</div>
                        <div>${reservedTime}</div>
                        <div class="after-time">${afterTime} 後可接</div>`
                    ;
                    tableDiv.appendChild(timeInfo);
                }

                tableDiv.onclick = () => toggleTable(table);
                container.appendChild(tableDiv);
            });
        }

        function toggleTable(table) {
            if (tableStatus[table]?.status === "reserved") {
                return;
            }
            
            if (!tableStatus[table] || tableStatus[table].status === "empty") {
                tableStatus[table] = { 
                    status: "occupied", 
                    startTime: new Date() 
                };
            } else if (tableStatus[table].status === "occupied") {
                tableStatus[table] = { status: "finished" };
            } else {
                tableStatus[table] = { status: "empty" };
            }
            renderTables();
            renderReservedList();
            renderWaitingList();
        }

        function formatTime(date) {
            return date.toLocaleTimeString("zh-TW", { 
                hour: "2-digit", 
                minute: "2-digit", 
                hour12: false 
            });
        }

        function getTimeBeforeReservation(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const date = new Date();
            date.setHours(hours);
            date.setMinutes(minutes - 90);
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function getTimeAfterReservation(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const date = new Date();
            date.setHours(hours);
            date.setMinutes(minutes + 90);
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function selectTitleReserved(title) {
            selectedTitleReserved = title;
            document.getElementById("mrButtonReserved").classList.toggle("active", title === "先生");
            document.getElementById("msButtonReserved").classList.toggle("active", title === "小姐");
        }

        function selectTitleWaiting(title) {
            selectedTitleWaiting = title;
            document.getElementById("mrButtonWaiting").classList.toggle("active", title === "先生");
            document.getElementById("msButtonWaiting").classList.toggle("active", title === "小姐");
        }

        function addToReservedList() {
            const count = document.getElementById("reservedCount").value;
            const name = document.getElementById("reservedName").value;
            const phone = document.getElementById("reservedPhone").value;
            const reservedTime = document.getElementById("reservedTime").value;
            
            if (!count || !name || !phone || !reservedTime) return;
            
            const reservation = {
                id: reservationCounter++,
                count,
                name,
                title: selectedTitleReserved,
                phone,
                reservedTime,
                assignedTable: null
            };
            
            reservedList.push(reservation);
            clearReservedInputs();
            renderReservedList();
        }

        function addToWaitingList() {
            const count = document.getElementById("waitingCount").value;
            const name = document.getElementById("waitingName").value;
            const phone = document.getElementById("waitingPhone").value;
            
            if (!count || !name || !phone) return;
            
            const waiting = {
                id: waitingCounter++,
                count,
                name,
                title: selectedTitleWaiting,
                phone,
                assignedTable: null
            };
            
            waitingList.push(waiting);
            clearWaitingInputs();
            renderWaitingList();
        }

        function renderReservedList() {
            const list = document.getElementById("reservedList");
            list.innerHTML = "";
            
            reservedList.forEach((guest, index) => {
                const li = document.createElement("li");
                li.className = "waitlist-item";
                li.innerHTML = `訂${guest.id} - ${guest.count}位 - ${guest.title} ${guest.name} - ${guest.phone} - 訂位時間 ${guest.reservedTime}`;
                
                const buttonContainer = document.createElement("div");
                buttonContainer.className = "button-container";

                if (!guest.assignedTable) {
                    tables.forEach(table => {
                        const button = document.createElement("button");
                        button.className = "table-button";
                        button.textContent = `A${table}`;
                        button.onclick = () => assignTable(guest.id, table, guest.reservedTime, index);
                        buttonContainer.appendChild(button);
                    });
                } else {
                    const confirmButton = document.createElement("button");
                    confirmButton.className = "confirm-button";
                    confirmButton.textContent = `確認入座 A${guest.assignedTable}`;
                    confirmButton.onclick = () => confirmSeating(guest.assignedTable, index);
                    buttonContainer.appendChild(confirmButton);
                }

                const cancelButton = document.createElement("button");
                cancelButton.className = "cancel-button";
                cancelButton.textContent = "取消訂位";
                cancelButton.onclick = () => cancelReservedOrder(index);
                buttonContainer.appendChild(cancelButton);

                li.appendChild(buttonContainer);
                list.appendChild(li);
            });
        }

        function renderWaitingList() {
            const list = document.getElementById("waitingList");
            list.innerHTML = "";
            
            waitingList.forEach((guest, index) => {
                const li = document.createElement("li");
                li.className = "waitlist-item";
                li.innerHTML = `候${guest.id} - ${guest.count}位 - ${guest.title} ${guest.name} - ${guest.phone}`;
                
                const buttonContainer = document.createElement("div");
                buttonContainer.className = "button-container";

                if (!guest.assignedTable) {
                    tables.forEach(table => {
                        const button = document.createElement("button");
                        button.className = "table-button";
                        button.textContent = `A${table}`;
                        button.onclick = () => assignWaitingTable(table, index);
                        buttonContainer.appendChild(button);
                    });
                } else {
                    li.innerHTML += ` - A${guest.assignedTable}`;
                    const confirmButton = document.createElement("button");
                    confirmButton.className = "confirm-button";
                    confirmButton.textContent = "確認入座";
                    confirmButton.onclick = () => confirmWaitingSeating(guest.assignedTable, index);
                    buttonContainer.appendChild(confirmButton);
                }

                const cancelButton = document.createElement("button");
                cancelButton.className = "cancel-button";
                cancelButton.textContent = "取消候位";
                cancelButton.onclick = () => cancelWaitingOrder(index);
                buttonContainer.appendChild(cancelButton);

                li.appendChild(buttonContainer);
                list.appendChild(li);
            });
        }

        function assignTable(reservationId, table, reservedTime, index) {
            tableStatus[table] = {
                status: "reserved",
                reservationId: reservationId,
                reservedTime: reservedTime
            };
            reservedList[index].assignedTable = table;
            renderTables();
            renderReservedList();
        }

        function assignWaitingTable(table, index) {
            waitingList[index].assignedTable = table;
            renderWaitingList();
        }

        function confirmSeating(table, index) {
            tableStatus[table] = {
                status: "occupied",
                startTime: new Date()
            };
            reservedList.splice(index, 1);
            renderTables();
            renderReservedList();
        }

        function confirmWaitingSeating(table, index) {
            tableStatus[table] = {
                status: "occupied",
                startTime: new Date()
            };
            waitingList.splice(index, 1);
            renderTables();
            renderWaitingList();
        }

        function cancelReservedOrder(index) {
            const canceledReservation = reservedList[index];
            if (canceledReservation.assignedTable) {
                delete tableStatus[canceledReservation.assignedTable];
            }
            reservedList.splice(index, 1);
            renderReservedList();
            renderTables();
        }

        function cancelWaitingOrder(index) {
            const canceledWaiting = waitingList[index];
            if (canceledWaiting.assignedTable) {
                delete tableStatus[canceledWaiting.assignedTable];
            }
            waitingList.splice(index, 1);
            renderWaitingList();
            renderTables();
        }

        function clearReservedInputs() {
            document.getElementById("reservedCount").value = "";
            document.getElementById("reservedName").value = "";
            document.getElementById("reservedPhone").value = "";
            document.getElementById("reservedTime").value = "11:00";
        }

        function clearWaitingInputs() {
            document.getElementById("waitingCount").value = "";
            document.getElementById("waitingName").value = "";
            document.getElementById("waitingPhone").value = "";
        }

        // 初始化頁面
        renderTables();
        renderReservedList();
        renderWaitingList();
    </script>
</body>
</html>
